#!/usr/bin/env bash
this_start=$(date +%s)

function getStatus()
{
  status=`status.sh | grep String | awk '{print $2}' | tr -d "'"`
#  [ $1 != "$status" ] && (echo $status)
  echo $status
}

getStatus "nil"
# [ $status == 'Existing'] && (kill_daqinterface_on_partition.sh 0; exit 0 )


#setdaqcomps.sh crt01
#setdaqcomps.sh crt01PULL pmtx03 
#setdaqcomps.sh pmtx03
#setdaqcomps.sh pmtx04
#setdaqcomps.sh spectdc pmtx03
#setdaqcomps.sh spectdc pmtx03 crt01PULL
#setdaqcomps.sh pmtx03 crt2x2upstrPULL crt2x2dwnstrPULL ptb01PULL spectdc
#setdaqcomps.sh pmtx03 crt2x2dwnstrPULL ptb01PULL spectdc
#setdaqcomps.sh pmtx03 ptb01PULL spectdc
#setdaqcomps.sh pmtx03 crt2x2upstrPULL crt2x2dwnstrPULL spectdc
#setdaqcomps.sh pmtx03 crt2x2upstrPULL crt2x2dwnstrPULL ptb01PULL
##setdaqcomps.sh pmtx03 crt01PULL spectdc
#setdaqcomps.sh pmtx03 crt01PULL spectdc ptb01PULL

#setdaqcomps.sh wib101 wib102 wib103 wib104 wib105 wib106 tpc01 tpc02 tpc05 ntb01

#setdaqcomps.sh wib106 wib105 wib104 wib103 wib102 tpc02 tpc01 ntb01
#setdaqcomps.sh wib101 wib102 wib103 wib104 wib105 wib106 tpc05 tpc02 tpc01 ntb01
#setdaqcomps.sh wib104
#setdaqcomps.sh mbb02 wib101 wib102 wib103 wib104 wib105 wib106 tpc05 tpc02 tpc01 ntb01
#setdaqcomps.sh mbb02 wib101 wib102 wib103 wib104 wib105 wib106 wib201 wib202 wib203 wib204 wib205 wib206 wib301 wib302 wib303 wib304 wib305 wib306 wib401 wib402 wib403 wib404 wib405 wib406 tpc11 tpc10 tpc09 tpc08 tpc07 tpc06 tpc05 tpc04 tpc03 tpc02 tpc01 ntb01 
#setdaqcomps.sh tpc01 ntb01
#setdaqcomps.sh mbb02 tpc05 tpc02 tpc01 ntb01

#setdaqcomps.sh tpc01 ntb01
setdaqcomps.sh tpc01 ntb01 ptb01PULL spectdc pmt01 pmt02 pmt03 pmt04 pmt05 pmt06 pmt07 pmt08 pmt09
#setdaqcomps.sh mbb02 wib101 wib102 wib103 wib104 wib105 wib106 wib201 wib202 wib203 wib204 wib205 wib206 wib301 wib302 wib303 wib304 wib305 wib306 wib401 wib402 wib403 wib404 wib405 wib406 tpc11 tpc10 tpc09 tpc08 tpc07 tpc06 tpc05 tpc04 tpc03 tpc02 tpc01 ntb01

#setdaqcomps.sh wib101 wib102 wib103 wib104 wib105 wib106 wib201 wib202 wib203 wib204 wib205 wib206 wib301 wib302 wib303 wib304 wib305 wib306 wib401 wib402 wib403 wib404 wib405 wib406 tpc11 tpc10 tpc09 tpc08 tpc07 tpc06 tpc05 tpc04 tpc03 tpc02 tpc01 ntb01 

#setdaqcomps.sh mbb02 tpc11 tpc10 tpc09 tpc08 tpc07 tpc06 tpc05 tpc04 tpc03 tpc02 tpc01 ntb01 

#setdaqcomps.sh tpc11 tpc10 tpc09 tpc08 tpc07 tpc06 tpc05 tpc04 tpc03 tpc02 tpc01 ntb01

#setdaqcomps.sh mbb02 tpc11 tpc10 tpc09 tpc08 tpc07 tpc06 tpc05 tpc04 tpc03 tpc02 tpc01 ntb01 
#
#setdaqcomps.sh mbb02 wib102 wib103 wib104 wib306 wib401 wib402 tpc09 tpc01 ntb01 
#setdaqcomps.sh mbb02 wib401 wib402

#setdaqcomps.sh mbb02 wib101 wib102 wib103 wib104 wib105 wib106 tpc02 tpc01 ntb01 
#setdaqcomps.sh wib304 wib305

#setdaqcomps.sh wib101 wib102 wib103 wib104 wib105 wib106 wib201 wib202 wib203 wib204 wib205 wib206 wib301 wib302 wib303 wib304 wib305 wib306 wib401 wib402 wib403 wib404 wib405 wib406

send_transition.sh boot boot.txt
getStatus "booting"
while [ "$status" != 'booted' ]
do
  sleep 2
  getStatus "booting"
  [ "$status" == 'stopped' ] && (kill_daqinterface_on_partition.sh $DAQINTERFACE_PARTITION_NUMBER; exit 1 )
done

#send_transition.sh config $2
send_transition.sh config standard

getStatus "configuring"
while [ "$status" != 'ready' ]
do
  sleep 2
  getStatus "configuring"
  [ "$status" == 'stopped' ] && (kill_daqinterface_on_partition.sh $DAQINTERFACE_PARTITION_NUMBER; exit 1 )
  # [ "$status" == 'stopped' ] && ( exit 1 )
done

# report_datafile_location

send_transition.sh start
  getStatus "starting"
sleep 2
getStatus "starting"
while [ "$status" != 'running' ]
do
  sleep 2
  getStatus "starting"
  [ "$status" == 'stopped' ] && (kill_daqinterface_on_partition.sh $DAQINTERFACE_PARTITION_NUMBER; exit 1 )
done

this_stop=$(date +%s)
echo "DAQ started in $(( this_stop - this_start )) seconds."
